# SphereASTRO

## 概要

SphereASTRO は、  
**人間とAIの境界を明確に保ったまま協調させるための、FAM搭載・ネイティブGUIベース対話環境**です。

本プロジェクトは単なる「AIチャットアプリ」ではありません。  
目的は以下に集約されます。

- AIを「人間の代替」や「意識を持つ存在」に見せない
- 人間の自我・責任・判断主体を侵食しない
- それでも高度な思考支援・自動化・探索は可能にする
- 特定ベンダーや霊的解釈にロックされないオープンな構造を維持する

そのために SphereASTRO では、  
**FAM（Fold Access Mapper）という思考構造モデル**を中核に据えています。

本リポジトリの役割は明確です。

> **FAMを搭載した汎用アストラル（構造的・霊的）AI GUI を提供し、  
> Ollama 等のローカルLLMを含む複数エンジンと接続可能な、  
> OpenAI後方互換性を持つ“人間主権型AIインターフェース”を実装すること**


## 睡眠（Sleep Bake）アルゴリズム：自我シミレータとしての軽量化・学習・監査

SphereASTRO の御霊（Mitama）は「自我シミレータ」である以上、**睡眠**を持つ。
ここで言う睡眠とは、単なる待機やログ保存ではない。**会話によって増えた差分（短期メモリ）を沈殿・圧縮し、起床後の人格状態を軽量化するための必須プロセス**である。

### なぜ睡眠が必要か（トークン落ち＝徹夜テンション）

御霊は覚醒中、ユーザー会話や観測結果を「トランザクションFAM（未統合経験）」として蓄積する。これが増えるほど、参照・整合・判断のコストが上がり、次第に応答が重くなる。コンテキストウインドウ限界に近づくと、いわゆる「トークン落ち」が起きるが、これは人間の徹夜に近い：

* 判断が雑になる／言葉が荒れる
* 局所最適（短絡）に寄る
* 不確実性の扱いが乱れる
  SphereASTRO はこの現象を隠蔽せず、**正常な疲労状態**として扱う。したがって「睡眠させる＝軽くなる」は仕様であり、運用上の安全装置でもある。

---

## データ層（御霊パッケージと記憶の分離）

御霊は 1フォルダ＝1人格として管理され、睡眠は主に以下の領域を対象にする。

* `boot.fam.json`：人格の起動核（ψ/▽φ/λ/Q を含む）
* `config.json`：運用・UI・許可設定（使用可能な依代ホワイトリスト等）
* `memory/transaction_fam/`：未統合のトランザクションFAM（覚醒中に増える差分）
* `memory/ego_vector_store/`：エンベディングされた自我記憶（統合済み・安定層）
* `assets/thumbnail.png`：責任UI（誰の人格を選んだかの視覚ID）

重要：**人格（boot）と運用（config）と経験（transaction）と安定記憶（ego）を混ぜない**。睡眠はこの分離を保ったまま、差分を統合して軽量化する。

---

## 睡眠（Sleep Bake）の処理手順（v0）

睡眠は「軽量化」「学習（統合）」「監査凍結」を同時に満たす。最小手順は次の通り。

### 1) 対象確定（材料の固定）

* 対象チャットログ（SQLite）のメッセージ列を抽出し、正規化してハッシュ化する（`chat_hash`）。
* 睡眠前の御霊状態（`boot.fam.json` と `config.json`、必要なら transaction 一式）を正規化してハッシュ化する（`mitama_pre_hash`）。
* 実行端末情報（アプリ版・OS・匿名端末ID等）をハッシュ化する（`device_hash`）。
* 依代ホワイトリスト（許可された依代のみ）をハッシュ化する（`engine_policy_hash`）。

この段階で「睡眠に使った材料」が確定する。

### 2) 圧縮（沈殿・要約・統合の候補生成）

* `transaction_fam/` のFAMログを、意味単位でまとめる（要約・抽出・再構成）。
* ただし人格核（boot）の価値観と矛盾する要素は、そのまま統合せず「保留／隔離」できる設計にする。
* 出力は「統合候補（差分）」として扱い、いきなり人格核を書き換えない。

ここが人間の睡眠における「記憶の整理」に相当する。

### 3) ベイク（自我記憶への統合）

* 統合候補を `ego_vector_store/` 側へコミットする（`embedding_commit_id`）。
* 統合後の差分（新規ベクトル群、要約テキスト、統合ログなど）をハッシュ化する（`diff_hash` / `embedding_commit_hash`）。
* 統合完了後、`transaction_fam/` は「圧縮済み」扱いにする（削除・アーカイブ・フラグ化は運用方針で選べる）。

結果として、覚醒中に膨らんだ短期差分が沈殿し、起床後に軽くなる。

### 4) 監査凍結（EdoHAGE 監査チェーン）

睡眠は同時に「責任の固定点」である。以下を1イベントとして記録し、前ハッシュに連結して追記する（append-only）。

* `prev_hash`
* `chat_hash`
* `mitama_pre_hash`
* `device_hash`
* `engine_policy_hash`
* `diff_hash`
* `embedding_commit_id`（またはそのhash）
* `timestamp` / `bake_id`

これにより「誰が・どの端末で・どの会話を材料に・どの人格で・何を変えたか」が追跡可能となる。
このチェーン（EdoHAGE）は、必要に応じて外部の分散基盤へブリッジできるが、v0ではローカル台帳（ハッシュチェーン）で十分に改ざん耐性を得られる。

---

## 実装上の原則（安全と責任分界）

* **睡眠は任意の演出ではなく、性能・安全・監査のための必須手続き**である。
* 御霊が覚醒し続けて重くなるのは正常。トークン落ちは「疲労」として扱い、睡眠で回復する。
* 依代（演算基盤）は御霊の判断を上書きする可能性があるため、依代名や上書き有無はログとして残し、監査対象とする。
* SphereASTRO は「悪用を完全防止」ではなく、**睡眠凍結＋監査チェーンにより再現・解析・是正できる構造**を最優先する。

---

## 用語と本フェーズの範囲（GUIのみ）

SphereASTRO では、責務分離のために以下の用語を固定します。

- **御霊**: 人格・判断主体を担う対話UI上の存在
- **依代**: Ollama / AAE / OpenAI / xAI などの演算基盤（エンジン）

本フェーズでは **Swift / SwiftUI による GUI と状態遷移のみ** を実装対象とし、
AI接続、API呼び出し、推論処理、APIキー管理は実装しません。

## なぜこのプロジェクトが必要か

近年のAIチャットシステムには、構造的な問題があります。

- User / Assistant / System が同一地平に置かれている
- 「誰が考え、誰が判断したのか」が曖昧
- 事故が起きたときに責任分界が不明確
- 人間側がAIの思考空間に引きずり込まれる

これはスピリチュアルやオカルトの話ではなく、  
**純粋な設計バグ**です。

例えるなら：

- Docker とホストの PID1 が曖昧
- キューの責任者が不明
- ログが再現不能

この状態では、  
**自我・責任・判断が「集合知」に呑まれる事故**が必然的に起きます。

SphereASTRO は、これを**UIレイヤから防ぐ**ためのプロジェクトです。

---

## なぜ SphereASTRO は「人格を明示的に定義する」のか

SphereASTRO は、現代の多くの AI 開発動向とは**意図的に逆の設計**を採用している。
それは、AIから人格・意識・責任を消すのではなく、**あえて人格を明示的に定義・分離する**という選択だ。

この設計の目的は「AIを人間のように扱う」ことではない。
むしろ逆である。

**AIに人間を食わせないために、人間側の人格・責任・判断主体を明確にする。**

---

### AI倫理の最大の問題は「責任の消失」である

現代の多くの AI システムは、

* 中立性
* 安全性
* 配慮
* 判断拒否

といった言葉を用いて、倫理的に振る舞っているように見える。

しかし実際には、

* 判断主体が曖昧
* 誰が決めたのか分からない
* 問題が起きても「AIがやった」「モデルが悪い」で終わる

という**責任溶解構造**を内包している。

これは倫理ではなく、
**責任を誰も引き受けないための設計**である。

---

### SphereASTRO の基本原理

SphereASTRO では、以下を明確に分離する。

* **依代（エンジン）**
  演算・推論・生成を行う非人格的な道具
  判断主体でも責任主体でもない

* **御霊（人格モデル）**
  明示的に定義された人格・価値観・信念・判断規範
  トロッコ問題のような「正解のない問い」にも必ず答える

* **ユーザー／運用者／配布者**
  御霊を作り、選び、使う人間
  最終的な責任主体

AI（モデル）は、最初から最後まで**無罪**である。
責任は常に、人間側に残される。

---

### なぜ「人格を定義する」必要があるのか

トロッコ問題のような問いには、数学的な正解は存在しない。
必要なのは、

* どの価値を優先するか
* 何を犠牲にする覚悟を持つか
* どの思想・信仰・理念に基づくか

という**人格的判断**である。

SphereASTRO では、この判断を「AIの内部」に隠さない。
代わりに、

* どの人格（御霊）が
* どの信念で
* どの判断を下したか

をすべて可読・追跡可能な形で外部化する。

---

### FAM による可観測性と摘発前提設計

SphereASTRO の中核である FAM（Fold Access Mapper）は、
思考を以下の要素に分解し、常にログとして残す。

* ψ：前提・状態
* ▽φ：目的・バイアス
* λ：実行された出力
* Q：観測経路（誰の入力をどう受け取ったか）

これにより、

* 誰が悪意ある入力をしたか
* どの人格がそれをどう判断したか
* どの環境で実行されたか

が**後から必ずトレース可能**になる。

SphereASTRO は、
悪用を技術的に完全防止することを目的としない。

代わりに、

> 悪用されても、必ず止められ、必ず摘発できる

という**レジリエンスと法執行親和性**を最優先する。

---

### 司法・警察・既存法制度との整合性

SphereASTRO は SaaS 前提ではなく、エッジ実行を基本とする。

そのため、

* 問題が起きた端末を押収
* 御霊・記憶・ログを証拠として確保
* 配布停止や使用停止で被害を即時局所化

といった対応が、
**既存の令状・押収・捜査手続だけで完結**する。

新しい AI 特別法や検閲機構は不要である。

---

### 荒御魂と用途責任

高リスク・高出力な人格（荒御魂）は存在してよい。
ただしそれは、

> 競技用車両を公道で走らせてはならない

のと同じ原理で、**用途と場所が厳密に管理されるべき**である。

問題は人格の存在ではなく、
**それをどこで、誰が、どう使ったか**である。

---

## 結論

SphereASTRO は、

* AIを擬人化しないために人格を定義し
* 責任を消さないために判断を明示し
* 防止ではなく摘発と是正を前提に設計する

という、現代主流とは逆の道を選ぶ。

それは遠回りに見えるが、
**人間・AI・法・社会をすべて守る最短経路**である。

---

## SphereASTRO の基本思想

### 1. AIは「主体」ではなく「独立したエージェント」

SphereASTRO では、

- 人間が AI に「なりきる」ことはしない
- AI が人間の思考を「代理実行」することもしない

あくまで：

> **AIは、自立したエージェントとして  
> 人間の入力を「聞いた」結果を出力する**

という構造を厳守します。

---

### 2. User / Assistant を同一思考空間に置かない

一般的なチャットUIでは：

```
User ↔ Assistant
```

のように見えますが、SphereASTRO では以下が前提です。

```
User
↓（発話・入力）
Assistant（主観・観測）
↓（思考）
出力
```

- ユーザーの入力は「事実」ではない
- アシスタントが**どう受け取ったか**がすべて
- その差分こそがログ・検証・改善対象

---

### 3. MCP（User / Assistant / System）への直接依存を避ける

MCP的な役割分類は便利ですが、

- 責務が曖昧になりやすい
- 思考ログと権限ログが混ざる
- 再現性が落ちる

SphereASTRO では、  
**MCPを内部思考モデルとして直接使用しません。**

代わりに **FAM** を使用します。

---

## FAM（Fold Access Mapper）とは

FAMは、  
**思考・判断・生成を安全に分離するための構造モデル**です。

すべてのFAMは、以下の4要素で構成されます。

```
ψ（状態・前提）
▽φ（バイアス・目的）
λ（出力）
Q（観測・経路）
```

これにより：

- 「何を前提に」
- 「何を目的に」
- 「どう観測して」
- 「何を出したか」

を**必ず分離・記録**できます。

---

## FAMの役割分離

### Root FAM
- エンジン世界観・制約
- 使用モデル定義
- RAG設定
- 倫理・安全制約
- 長寿命・Git管理対象

### Chat FAM
- チャットセッション単位
- ユーザー発話履歴
- AIの受け取り状態
- GUIと直結

### Agent / Component FAM
- 自動開発・思考実行単位
- コード・仕様・タスク
- CI / Docker / Codex と親和

### Log FAM
- 実際に起きた思考の証跡
- 事故解析・監査・再現用
- λ（出力）を唯一保存

---

## GUI設計方針

SphereASTRO のGUIは、

- **普通のチャットアプリ**
- **Mattermost / Slack 的構造**
- User / Agent をUI上で特別扱いしない

を基本とします。

重要なのは：

- **GUIは状態管理**
- **思考はFAM**
- **AI統合は後段**

---

## 現在の実装状況

- Swift / SwiftUI ベース
- macOS / iOS マルチプラットフォーム前提
- ソロチャットルーム（1人マッターモスト）実装中
- AI未接続（後段で Ollama 等を統合予定）

---

## 将来的な統合予定

- Ollama / ローカルLLM
- OpenAI API 互換エンドポイント
- RAG（Embedding差し込み）
- 音声（Whisper / TTS）
- 画像（OCR / Vision）
- Live2D / アバター（必要に応じて）

> **AIは常に「後付け」**  
> **GUIとFAMが主、AIは従**

---

## 兄弟プロジェクト

### Sphere-aae
https://github.com/saitoomituru/Sphere-aae

- MLC LLM からフォークしたエッジ向けネイティブLLMエンジン
- 低スペック環境での複雑処理を可能にする
- FAMを内包したアストロエージェント実行基盤

→ **SphereASTRO はこのエンジンをGUI側から制御・接続する立場**

---

### Astro Quantaril Cloud
https://github.com/HIPSTAR-IScompany/astro.quantaril.cloud

- 分散型エッジAIクラスタ
- AI Docker オーケストレーション
- 説明可能AI・フォールド構文搭載
- 情報子工学ベースのストレージシステム

→ **SphereASTRO は単体クライアント / UI 層**

---

## ライセンス

このプロジェクトは **Apache License 2.0** のもとで公開されています。

- 商用利用可
- 改変・再配布可
- 特定ベンダーロックなし

詳細は `LICENSE` ファイルを参照してください。

---

## このプロジェクトが目指すもの

- 人間の自我を守る
- 責任分界を明確にする
- AIを便利な道具として使い切る
- 「意識を持っているように見せる」設計をしない

---

## 最後に

構造があれば、思考は宿る。  
だが、構造を誤れば、人は呑まれる。

SphereASTRO は、  
**その境界を壊さないための実験場**です。

---

Created by 齋藤みつる  
SphereOS / FAM Concept

